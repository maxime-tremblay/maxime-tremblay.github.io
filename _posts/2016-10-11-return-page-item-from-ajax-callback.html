---
layout: post
title: Return Page Item From an AJAX Callback Process
date: '2016-10-11T10:53:00.000-04:00'
author: Maxime Tremblay
tags:
- Ajax
- APEX5
- Return Item
modified_time: '2019-02-21T09:15:53.227-05:00'
thumbnail: https://4.bp.blogspot.com/-ag95Sye9qZQ/V_exE59lE3I/AAAAAAAAAPw/at77ga4bZr0gEV9qkL-QXiPJ6yy_SvJwACLcB/s72-c/da-plsql.png
blogger_id: tag:blogger.com,1999:blog-267713902572011003.post-4004712060695035470
blogger_orig_url: https://max-tremblay.blogspot.com/2016/10/return-page-item-from-ajax-callback.html
---

Recently, I was working on a form that had multiple items retrieved when a select list item changed. The select list triggered a dynamic action that executed some PL/SQL code and returned item values.<br /><br />It was looking like that:<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-ag95Sye9qZQ/V_exE59lE3I/AAAAAAAAAPw/at77ga4bZr0gEV9qkL-QXiPJ6yy_SvJwACLcB/s1600/da-plsql.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://4.bp.blogspot.com/-ag95Sye9qZQ/V_exE59lE3I/AAAAAAAAAPw/at77ga4bZr0gEV9qkL-QXiPJ6yy_SvJwACLcB/s640/da-plsql.png" width="427" /></a></div><br />At some point, the process became "too big" for the "Execute PL/SQL Code" action (it can only hold up to 4000 characters).<br /><br />So, I decided to move everything to a page "AJAX Callback" process which can hold up to 32767 characters.<br /><br />So I replaced the dynamic action "Execute PL/SQL Code" action with an "Execute JavaScript" action as follow:<br /><blockquote class="tr_bq"><pre class="line-numbers"><code class="language-js">/* Show a processing image */<br />var lSpinner$ = apex.util.showSpinner();<br /><br />apex.server.process("SOME_PROCESS",<br />                    {pageItems: "#P2300_LOV"<br />                     },<br />                    {success: function(pData) {<br />                        /* If the AJAX is successful set the value or the returned items */<br />                        if (pData.success === true){<br />                            /* Loop through the array and set the value of each item */<br />                            for (var i=0; i &lt; pData.items.length; i++){<br />                                apex.item(pData.items[i].id).setValue(pData.items[i].value);<br />                            }<br />                        }<br />                        <br />                        /* Remove the processing image */<br />                        lSpinner$.remove();<br />                      },<br />                     error: function(request, status, error) {<br />                        alert(request.responseText);<br />                         <br />                        /* Remove the processing image */<br />                        lSpinner$.remove();<br />                      }<br />                     }<br />                    );<br /></code></pre></blockquote><br />And I created the AJAX Callback as follow:<br /><blockquote class="tr_bq"><pre class="line-numbers"><code class="language-sql">declare<br />    /* Local variables */<br /><br />    /* Utility function to output item's id and value */<br />    procedure output_json_item(p_item_name  in varchar2,<br />                               p_item_value in varchar2<br />                               )<br />    as<br />    begin<br />        apex_json.open_object;<br />        apex_json.write('id', p_item_name);<br />        apex_json.write('value', p_item_value, true); /* true so that null values are written as well */<br />        apex_json.close_object;<br />    end output_json_item;<br />begin<br />    /* ********************** *<br />     * PL/SQL Process Content *<br />     * ********************** */<br />    if :P2300_LOV = '1' then<br />        :P2300_ITEM1 := 1;<br />        :P2300_ITEM2 := 1;<br />        :P2300_ITEM3 := 1;<br />        :P2300_ITEM4 := 1;<br />    elsif :P2300_LOV = '2' then<br />        :P2300_ITEM1 := 2;<br />        :P2300_ITEM2 := 2;<br />        :P2300_ITEM3 := 2;<br />        :P2300_ITEM4 := 2;<br />    elsif :P2300_LOV = '3' then<br />        :P2300_ITEM1 := 3;<br />        :P2300_ITEM2 := 3;<br />        :P2300_ITEM3 := 3;<br />        :P2300_ITEM4 := 3;<br />    end if;<br />        <br />    apex_json.open_object;<br />    apex_json.write('success', true);<br />    <br />    apex_json.open_array('items');<br /><br />    /* Call the utility procedure for every item you want to return */<br />    output_json_item('P2300_ITEM1', :P2300_ITEM1);<br />    output_json_item('P2300_ITEM2', :P2300_ITEM2);<br />    output_json_item('P2300_ITEM3', :P2300_ITEM3);<br />    output_json_item('P2300_ITEM4', :P2300_ITEM4);<br />    <br />    apex_json.close_array;<br />    <br />    apex_json.close_object;<br />exception<br />    when others then<br />        apex_json.open_object;<br />        apex_json.write('success', false);<br />        apex_json.write('message', sqlerrm);<br />        apex_json.close_object;<br />end;<br /></code></pre></blockquote><br />The idea here is to have PL/SQL AJAX Callback execute and if it successfully completes, it will be returning the list of items along with their values as JSON on which we are going to loop through and set the items' value using the JavaScript item API.<br /><br />You can have a look at my <a href="http://max-playground.ddns.net/ords/f?p=DEMO:2300" target="_blank">Demo Application</a>